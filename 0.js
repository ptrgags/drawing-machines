(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{61:function(e,t,r){"use strict";var i=r(0),n=r(37),o=r(2),a=r(19),s=r(28);a.a.CreateRibbon=function(e){var t=e.pathArray,r=e.closeArray||!1,i=e.closePath||!1,n=e.invertUV||!1,s=Math.floor(t[0].length/2),u=e.offset||s;u=u>s?s:Math.floor(u);var c,h,l,f,d=0===e.sideOrientation?0:e.sideOrientation||a.a.DEFAULTSIDE,p=e.uvs,v=e.colors,y=[],_=[],g=[],m=[],x=[],b=[],C=[],A=[],w=[],P=[];if(t.length<2){var O=[],M=[];for(l=0;l<t[0].length-u;l++)O.push(t[0][l]),M.push(t[0][l+u]);t=[O,M]}var S,D,T,V,z,I=0,L=i?1:0;for(c=t[0].length,h=0;h<t.length;h++){for(C[h]=0,x[h]=[0],c=c<(D=(S=t[h]).length)?c:D,f=0;f<D;)y.push(S[f].x,S[f].y,S[f].z),f>0&&(T=S[f].subtract(S[f-1]).length()+C[h],x[h].push(T),C[h]=T),f++;i&&(f--,y.push(S[0].x,S[0].y,S[0].z),T=S[f].subtract(S[0]).length()+C[h],x[h].push(T),C[h]=T),w[h]=D+L,P[h]=I,I+=D+L}var E,U,F=null,R=null;for(l=0;l<c+L;l++){for(A[l]=0,b[l]=[0],h=0;h<t.length-1;h++)V=t[h],z=t[h+1],l===c?(F=V[0],R=z[0]):(F=V[l],R=z[l]),T=R.subtract(F).length()+A[l],b[l].push(T),A[l]=T;r&&R&&F&&(V=t[h],z=t[0],l===c&&(R=z[0]),T=R.subtract(F).length()+A[l],A[l]=T)}if(p)for(h=0;h<p.length;h++)m.push(p[h].x,p[h].y);else for(h=0;h<t.length;h++)for(l=0;l<c+L;l++)E=0!=C[h]?x[h][l]/C[h]:0,U=0!=A[l]?b[l][h]/A[l]:0,n?m.push(U,E):m.push(E,U);for(var N=0,B=w[h=0]-1,k=w[h+1]-1,G=B<k?B:k,j=P[1]-P[0],X=r?w.length:w.length-1;N<=G&&h<X;)_.push(N,N+j,N+1),_.push(N+j+1,N+1,N+j),(N+=1)===G&&(++h===w.length-1?(j=P[0]-P[h],B=w[h]-1,k=w[0]-1):(j=P[h+1]-P[h],B=w[h]-1,k=w[h+1]-1),N=P[h],G=B<k?B+N:k+N);if(a.a.ComputeNormals(y,_,g),i){var H=0,Z=0;for(h=0;h<t.length;h++)H=3*P[h],Z=h+1<t.length?3*(P[h+1]-1):g.length-3,g[H]=.5*(g[H]+g[Z]),g[H+1]=.5*(g[H+1]+g[Z+1]),g[H+2]=.5*(g[H+2]+g[Z+2]),g[Z]=g[H],g[Z+1]=g[H+1],g[Z+2]=g[H+2]}a.a._ComputeSides(d,y,_,g,m,e.frontUVs,e.backUVs);var Y=null;if(v){Y=new Float32Array(4*v.length);for(var K=0;K<v.length;K++)Y[4*K]=v[K].r,Y[4*K+1]=v[K].g,Y[4*K+2]=v[K].b,Y[4*K+3]=v[K].a}var q=new a.a,W=new Float32Array(y),Q=new Float32Array(g),J=new Float32Array(m);return q.indices=_,q.positions=W,q.normals=Q,q.uvs=J,Y&&q.set(Y,o.b.ColorKind),i&&(q._idx=P),q},n.a.CreateRibbon=function(e,t,r,i,n,o,a,s,c){return void 0===r&&(r=!1),void 0===a&&(a=!1),u.CreateRibbon(e,{pathArray:t,closeArray:r,closePath:i,offset:n,updatable:a,sideOrientation:s,instance:c},o)};var u=function(){function e(){}return e.CreateRibbon=function(e,t,r){void 0===r&&(r=null);var u=t.pathArray,c=t.closeArray,h=t.closePath,l=n.a._GetDefaultSideOrientation(t.sideOrientation),f=t.instance,d=t.updatable;if(f){var p=i.o.Vector3[0].setAll(Number.MAX_VALUE),v=i.o.Vector3[1].setAll(-Number.MAX_VALUE),y=f.getVerticesData(o.b.PositionKind);if(function(e){for(var t=u[0].length,r=f,i=0,o=r._originalBuilderSideOrientation===n.a.DOUBLESIDE?2:1,a=1;a<=o;++a)for(var s=0;s<u.length;++s){var c=u[s],h=c.length;t=t<h?t:h;for(var l=0;l<t;++l){var d=c[l];e[i]=d.x,e[i+1]=d.y,e[i+2]=d.z,p.minimizeInPlaceFromFloats(d.x,d.y,d.z),v.maximizeInPlaceFromFloats(d.x,d.y,d.z),i+=3}if(r._creationDataStorage&&r._creationDataStorage.closePath){d=c[0];e[i]=d.x,e[i+1]=d.y,e[i+2]=d.z,i+=3}}}(y),f._boundingInfo?f._boundingInfo.reConstruct(p,v,f._worldMatrix):f._boundingInfo=new s.a(p,v,f._worldMatrix),f.updateVerticesData(o.b.PositionKind,y,!1,!1),t.colors){for(var _=f.getVerticesData(o.b.ColorKind),g=0,m=0;g<t.colors.length;g++,m+=4){var x=t.colors[g];_[m]=x.r,_[m+1]=x.g,_[m+2]=x.b,_[m+3]=x.a}f.updateVerticesData(o.b.ColorKind,_,!1,!1)}if(t.uvs){for(var b=f.getVerticesData(o.b.UVKind),C=0;C<t.uvs.length;C++)b[2*C]=t.uvs[C].x,b[2*C+1]=t.uvs[C].y;f.updateVerticesData(o.b.UVKind,b,!1,!1)}if(!f.areNormalsFrozen||f.isFacetDataEnabled){var A=f.getIndices(),w=f.getVerticesData(o.b.NormalKind),P=f.isFacetDataEnabled?f.getFacetDataParameters():null;if(a.a.ComputeNormals(y,A,w,P),f._creationDataStorage&&f._creationDataStorage.closePath)for(var O=0,M=0,S=0;S<u.length;S++)O=3*f._creationDataStorage.idx[S],M=S+1<u.length?3*(f._creationDataStorage.idx[S+1]-1):w.length-3,w[O]=.5*(w[O]+w[M]),w[O+1]=.5*(w[O+1]+w[M+1]),w[O+2]=.5*(w[O+2]+w[M+2]),w[M]=w[O],w[M+1]=w[O+1],w[M+2]=w[O+2];f.areNormalsFrozen||f.updateVerticesData(o.b.NormalKind,w,!1,!1)}return f}var D=new n.a(e,r);D._originalBuilderSideOrientation=l,D._creationDataStorage=new n.b;var T=a.a.CreateRibbon(t);return h&&(D._creationDataStorage.idx=T._idx),D._creationDataStorage.closePath=h,D._creationDataStorage.closeArray=c,T.applyToMesh(D,d),D},e}();a.a.CreateDisc=function(e){var t=new Array,r=new Array,i=new Array,n=new Array,o=e.radius||.5,s=e.tessellation||64,u=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,c=0===e.sideOrientation?0:e.sideOrientation||a.a.DEFAULTSIDE;t.push(0,0,0),n.push(.5,.5);for(var h=2*Math.PI*u,l=h/s,f=0;f<h;f+=l){var d=Math.cos(f),p=Math.sin(f),v=(d+1)/2,y=(1-p)/2;t.push(o*d,o*p,0),n.push(v,y)}1===u&&(t.push(t[3],t[4],t[5]),n.push(n[2],n[3]));for(var _=t.length/3,g=1;g<_-1;g++)r.push(g+1,0,g);a.a.ComputeNormals(t,r,i),a.a._ComputeSides(c,t,r,i,n,e.frontUVs,e.backUVs);var m=new a.a;return m.indices=r,m.positions=t,m.normals=i,m.uvs=n,m},n.a.CreateDisc=function(e,t,r,i,n,o){void 0===i&&(i=null);var a={radius:t,tessellation:r,sideOrientation:o,updatable:n};return c.CreateDisc(e,a,i)};var c=function(){function e(){}return e.CreateDisc=function(e,t,r){void 0===r&&(r=null);var i=new n.a(e,r);return t.sideOrientation=n.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,a.a.CreateDisc(t).applyToMesh(i,t.updatable),i},e}();a.a.CreateBox=function(e){var t,r=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],n=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],o=[],s=e.width||e.size||1,u=e.height||e.size||1,c=e.depth||e.size||1,h=e.wrap||!1,l=void 0===e.topBaseAt?1:e.topBaseAt,f=void 0===e.bottomBaseAt?0:e.bottomBaseAt,d=[2,0,3,1][l=(l+4)%4],p=[2,0,1,3][f=(f+4)%4],v=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(h){r=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],v=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];for(var y=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],_=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]],g=[17,18,19,16],m=[22,23,20,21];d>0;)y.unshift(y.pop()),g.unshift(g.pop()),d--;for(;p>0;)_.unshift(_.pop()),m.unshift(m.pop()),p--;y=y.flat(),_=_.flat(),v=v.concat(y).concat(_),r.push(g[0],g[2],g[3],g[0],g[1],g[2]),r.push(m[0],m[2],m[3],m[0],m[1],m[2])}var x=[s/2,u/2,c/2];t=v.reduce((function(e,t,r){return e.concat(t*x[r%3])}),[]);for(var b=0===e.sideOrientation?0:e.sideOrientation||a.a.DEFAULTSIDE,C=e.faceUV||new Array(6),A=e.faceColors,w=[],P=0;P<6;P++)void 0===C[P]&&(C[P]=new i.s(0,0,1,1)),A&&void 0===A[P]&&(A[P]=new i.d(1,1,1,1));for(var O=0;O<6;O++)if(o.push(C[O].z,C[O].w),o.push(C[O].x,C[O].w),o.push(C[O].x,C[O].y),o.push(C[O].z,C[O].y),A)for(var M=0;M<4;M++)w.push(A[O].r,A[O].g,A[O].b,A[O].a);a.a._ComputeSides(b,t,r,n,o,e.frontUVs,e.backUVs);var S=new a.a;if(S.indices=r,S.positions=t,S.normals=n,S.uvs=o,A){var D=b===a.a.DOUBLESIDE?w.concat(w):w;S.colors=D}return S},n.a.CreateBox=function(e,t,r,i,n){void 0===r&&(r=null);var o={size:t,sideOrientation:n,updatable:i};return h.CreateBox(e,o,r)};var h=function(){function e(){}return e.CreateBox=function(e,t,r){void 0===r&&(r=null);var i=new n.a(e,r);return t.sideOrientation=n.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,a.a.CreateBox(t).applyToMesh(i,t.updatable),i},e}();a.a.CreateSphere=function(e){for(var t=e.segments||32,r=e.diameterX||e.diameter||1,n=e.diameterY||e.diameter||1,o=e.diameterZ||e.diameter||1,s=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,u=e.slice&&e.slice<=0?1:e.slice||1,c=0===e.sideOrientation?0:e.sideOrientation||a.a.DEFAULTSIDE,h=new i.r(r/2,n/2,o/2),l=2+t,f=2*l,d=[],p=[],v=[],y=[],_=0;_<=l;_++){for(var g=_/l,m=g*Math.PI*u,x=0;x<=f;x++){var b=x/f,C=b*Math.PI*2*s,A=i.g.RotationZ(-m),w=i.g.RotationY(C),P=i.r.TransformCoordinates(i.r.Up(),A),O=i.r.TransformCoordinates(P,w),M=O.multiply(h),S=O.divide(h).normalize();p.push(M.x,M.y,M.z),v.push(S.x,S.y,S.z),y.push(b,g)}if(_>0)for(var D=p.length/3,T=D-2*(f+1);T+f+2<D;T++)d.push(T),d.push(T+1),d.push(T+f+1),d.push(T+f+1),d.push(T+1),d.push(T+f+2)}a.a._ComputeSides(c,p,d,v,y,e.frontUVs,e.backUVs);var V=new a.a;return V.indices=d,V.positions=p,V.normals=v,V.uvs=y,V},n.a.CreateSphere=function(e,t,r,i,n,o){var a={segments:t,diameterX:r,diameterY:r,diameterZ:r,sideOrientation:o,updatable:n};return l.CreateSphere(e,a,i)};var l=function(){function e(){}return e.CreateSphere=function(e,t,r){var i=new n.a(e,r);return t.sideOrientation=n.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,a.a.CreateSphere(t).applyToMesh(i,t.updatable),i},e}(),f=r(33);a.a.CreateCylinder=function(e){var t,r=e.height||2,n=0===e.diameterTop?0:e.diameterTop||e.diameter||1,o=0===e.diameterBottom?0:e.diameterBottom||e.diameter||1,s=e.tessellation||24,u=e.subdivisions||1,c=!!e.hasRings,h=!!e.enclose,l=e.arc&&(e.arc<=0||e.arc>1)?1:e.arc||1,f=0===e.sideOrientation?0:e.sideOrientation||a.a.DEFAULTSIDE,d=e.faceUV||new Array(3),p=e.faceColors,v=2+(1+(1!==l&&h?2:0))*(c?u:1);for(t=0;t<v;t++)p&&void 0===p[t]&&(p[t]=new i.d(1,1,1,1));for(t=0;t<v;t++)d&&void 0===d[t]&&(d[t]=new i.s(0,0,1,1));var y,_,g,m,x,b,C=new Array,A=new Array,w=new Array,P=new Array,O=new Array,M=2*Math.PI*l/s,S=(o-n)/2/r,D=i.r.Zero(),T=i.r.Zero(),V=i.r.Zero(),z=i.r.Zero(),I=i.r.Zero(),L=i.a.Y,E=1,U=1,F=0,R=0;for(m=0;m<=u;m++)for(g=((_=m/u)*(n-o)+o)/2,E=c&&0!==m&&m!==u?2:1,b=0;b<E;b++){for(c&&(U+=b),h&&(U+=2*b),x=0;x<=s;x++)y=x*M,D.x=Math.cos(-y)*g,D.y=-r/2+_*r,D.z=Math.sin(-y)*g,0===n&&m===u?(T.x=w[w.length-3*(s+1)],T.y=w[w.length-3*(s+1)+1],T.z=w[w.length-3*(s+1)+2]):(T.x=D.x,T.z=D.z,T.y=Math.sqrt(T.x*T.x+T.z*T.z)*S,T.normalize()),0===x&&(V.copyFrom(D),z.copyFrom(T)),A.push(D.x,D.y,D.z),w.push(T.x,T.y,T.z),R=c?F!==U?d[U].y:d[U].w:d[U].y+(d[U].w-d[U].y)*_,P.push(d[U].x+(d[U].z-d[U].x)*x/s,R),p&&O.push(p[U].r,p[U].g,p[U].b,p[U].a);1!==l&&h&&(A.push(D.x,D.y,D.z),A.push(0,D.y,0),A.push(0,D.y,0),A.push(V.x,V.y,V.z),i.r.CrossToRef(L,T,I),I.normalize(),w.push(I.x,I.y,I.z,I.x,I.y,I.z),i.r.CrossToRef(z,L,I),I.normalize(),w.push(I.x,I.y,I.z,I.x,I.y,I.z),R=c?F!==U?d[U+1].y:d[U+1].w:d[U+1].y+(d[U+1].w-d[U+1].y)*_,P.push(d[U+1].x,R),P.push(d[U+1].z,R),R=c?F!==U?d[U+2].y:d[U+2].w:d[U+2].y+(d[U+2].w-d[U+2].y)*_,P.push(d[U+2].x,R),P.push(d[U+2].z,R),p&&(O.push(p[U+1].r,p[U+1].g,p[U+1].b,p[U+1].a),O.push(p[U+1].r,p[U+1].g,p[U+1].b,p[U+1].a),O.push(p[U+2].r,p[U+2].g,p[U+2].b,p[U+2].a),O.push(p[U+2].r,p[U+2].g,p[U+2].b,p[U+2].a))),F!==U&&(F=U)}var N=1!==l&&h?s+4:s;for(m=0,U=0;U<u;U++){var B=0,k=0,G=0,j=0;for(x=0;x<s;x++)B=m*(N+1)+x,k=(m+1)*(N+1)+x,G=m*(N+1)+(x+1),j=(m+1)*(N+1)+(x+1),C.push(B,k,G),C.push(j,G,k);1!==l&&h&&(C.push(B+2,k+2,G+2),C.push(j+2,G+2,k+2),C.push(B+4,k+4,G+4),C.push(j+4,G+4,k+4)),m=c?m+2:m+1}var X=function(e){var t=e?n/2:o/2;if(0!==t){var a,u,c,h=e?d[v-1]:d[0],f=null;p&&(f=e?p[v-1]:p[0]);var y=A.length/3,_=e?r/2:-r/2,g=new i.r(0,_,0);A.push(g.x,g.y,g.z),w.push(0,e?1:-1,0),P.push(h.x+.5*(h.z-h.x),h.y+.5*(h.w-h.y)),f&&O.push(f.r,f.g,f.b,f.a);var m=new i.q(.5,.5);for(c=0;c<=s;c++){a=2*Math.PI*c*l/s;var x=Math.cos(-a),b=Math.sin(-a);u=new i.r(x*t,_,b*t);var M=new i.q(x*m.x+.5,b*m.y+.5);A.push(u.x,u.y,u.z),w.push(0,e?1:-1,0),P.push(h.x+(h.z-h.x)*M.x,h.y+(h.w-h.y)*M.y),f&&O.push(f.r,f.g,f.b,f.a)}for(c=0;c<s;c++)e?(C.push(y),C.push(y+(c+2)),C.push(y+(c+1))):(C.push(y),C.push(y+(c+1)),C.push(y+(c+2)))}};X(!1),X(!0),a.a._ComputeSides(f,A,C,w,P,e.frontUVs,e.backUVs);var H=new a.a;return H.indices=C,H.positions=A,H.normals=w,H.uvs=P,p&&(H.colors=O),H},n.a.CreateCylinder=function(e,t,r,i,o,a,s,u,c){void 0!==s&&s instanceof f.a||(void 0!==s&&(c=u||n.a.DEFAULTSIDE,u=s),s=a,a=1);var h={height:t,diameterTop:r,diameterBottom:i,tessellation:o,subdivisions:a,sideOrientation:c,updatable:u};return d.CreateCylinder(e,h,s)};var d=function(){function e(){}return e.CreateCylinder=function(e,t,r){var i=new n.a(e,r);return t.sideOrientation=n.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,a.a.CreateCylinder(t).applyToMesh(i,t.updatable),i},e}();a.a.CreateTorus=function(e){for(var t=[],r=[],n=[],o=[],s=e.diameter||1,u=e.thickness||.5,c=e.tessellation||16,h=0===e.sideOrientation?0:e.sideOrientation||a.a.DEFAULTSIDE,l=c+1,f=0;f<=c;f++)for(var d=f/c,p=f*Math.PI*2/c-Math.PI/2,v=i.g.Translation(s/2,0,0).multiply(i.g.RotationY(p)),y=0;y<=c;y++){var _=1-y/c,g=y*Math.PI*2/c+Math.PI,m=Math.cos(g),x=Math.sin(g),b=new i.r(m,x,0),C=b.scale(u/2),A=new i.q(d,_);C=i.r.TransformCoordinates(C,v),b=i.r.TransformNormal(b,v),r.push(C.x,C.y,C.z),n.push(b.x,b.y,b.z),o.push(A.x,A.y);var w=(f+1)%l,P=(y+1)%l;t.push(f*l+y),t.push(f*l+P),t.push(w*l+y),t.push(f*l+P),t.push(w*l+P),t.push(w*l+y)}a.a._ComputeSides(h,r,t,n,o,e.frontUVs,e.backUVs);var O=new a.a;return O.indices=t,O.positions=r,O.normals=n,O.uvs=o,O},n.a.CreateTorus=function(e,t,r,i,n,o,a){var s={diameter:t,thickness:r,tessellation:i,sideOrientation:a,updatable:o};return p.CreateTorus(e,s,n)};var p=function(){function e(){}return e.CreateTorus=function(e,t,r){var i=new n.a(e,r);return t.sideOrientation=n.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,a.a.CreateTorus(t).applyToMesh(i,t.updatable),i},e}();a.a.CreateTorusKnot=function(e){var t,r,n=new Array,o=new Array,s=new Array,u=new Array,c=e.radius||2,h=e.tube||.5,l=e.radialSegments||32,f=e.tubularSegments||32,d=e.p||2,p=e.q||3,v=0===e.sideOrientation?0:e.sideOrientation||a.a.DEFAULTSIDE,y=function(e){var t=Math.cos(e),r=Math.sin(e),n=p/d*e,o=Math.cos(n),a=c*(2+o)*.5*t,s=c*(2+o)*r*.5,u=c*Math.sin(n)*.5;return new i.r(a,s,u)};for(t=0;t<=l;t++){var _=t%l/l*2*d*Math.PI,g=y(_),m=y(_+.01),x=m.subtract(g),b=m.add(g),C=i.r.Cross(x,b);for(b=i.r.Cross(C,x),C.normalize(),b.normalize(),r=0;r<f;r++){var A=r%f/f*2*Math.PI,w=-h*Math.cos(A),P=h*Math.sin(A);o.push(g.x+w*b.x+P*C.x),o.push(g.y+w*b.y+P*C.y),o.push(g.z+w*b.z+P*C.z),u.push(t/l),u.push(r/f)}}for(t=0;t<l;t++)for(r=0;r<f;r++){var O=(r+1)%f,M=t*f+r,S=(t+1)*f+r,D=(t+1)*f+O,T=t*f+O;n.push(T),n.push(S),n.push(M),n.push(T),n.push(D),n.push(S)}a.a.ComputeNormals(o,n,s),a.a._ComputeSides(v,o,n,s,u,e.frontUVs,e.backUVs);var V=new a.a;return V.indices=n,V.positions=o,V.normals=s,V.uvs=u,V},n.a.CreateTorusKnot=function(e,t,r,i,n,o,a,s,u,c){var h={radius:t,tube:r,radialSegments:i,tubularSegments:n,p:o,q:a,sideOrientation:c,updatable:u};return v.CreateTorusKnot(e,h,s)};var v=function(){function e(){}return e.CreateTorusKnot=function(e,t,r){var i=new n.a(e,r);return t.sideOrientation=n.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,a.a.CreateTorusKnot(t).applyToMesh(i,t.updatable),i},e}(),y=r(1),_=r(10),g=r(35),m=r(39),x=r(29);n.a._instancedMeshFactory=function(e,t){return new b(e,t)};var b=function(e){function t(t,r){var i=e.call(this,t,r.getScene())||this;return i._indexInSourceMeshInstanceArray=-1,r.addInstance(i),i._sourceMesh=r,i.position.copyFrom(r.position),i.rotation.copyFrom(r.rotation),i.scaling.copyFrom(r.scaling),r.rotationQuaternion&&(i.rotationQuaternion=r.rotationQuaternion.clone()),i.infiniteDistance=r.infiniteDistance,i.setPivotMatrix(r.getPivotMatrix()),i.refreshBoundingInfo(),i._syncSubMeshes(),i}return y.c(t,e),t.prototype.getClassName=function(){return"InstancedMesh"},Object.defineProperty(t.prototype,"lightSources",{get:function(){return this._sourceMesh._lightSources},enumerable:!0,configurable:!0}),t.prototype._resyncLightSources=function(){},t.prototype._resyncLighSource=function(e){},t.prototype._removeLightSource=function(e){},Object.defineProperty(t.prototype,"receiveShadows",{get:function(){return this._sourceMesh.receiveShadows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._sourceMesh.material},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visibility",{get:function(){return this._sourceMesh.visibility},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._sourceMesh.skeleton},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderingGroupId",{get:function(){return this._sourceMesh.renderingGroupId},set:function(e){this._sourceMesh&&e!==this._sourceMesh.renderingGroupId&&_.a.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")},enumerable:!0,configurable:!0}),t.prototype.getTotalVertices=function(){return this._sourceMesh.getTotalVertices()},t.prototype.getTotalIndices=function(){return this._sourceMesh.getTotalIndices()},Object.defineProperty(t.prototype,"sourceMesh",{get:function(){return this._sourceMesh},enumerable:!0,configurable:!0}),t.prototype.isReady=function(e){return void 0===e&&(e=!1),this._sourceMesh.isReady(e,!0)},t.prototype.getVerticesData=function(e,t){return this._sourceMesh.getVerticesData(e,t)},t.prototype.setVerticesData=function(e,t,r,i){return this.sourceMesh&&this.sourceMesh.setVerticesData(e,t,r,i),this.sourceMesh},t.prototype.updateVerticesData=function(e,t,r,i){return this.sourceMesh&&this.sourceMesh.updateVerticesData(e,t,r,i),this.sourceMesh},t.prototype.setIndices=function(e,t){return void 0===t&&(t=null),this.sourceMesh&&this.sourceMesh.setIndices(e,t),this.sourceMesh},t.prototype.isVerticesDataPresent=function(e){return this._sourceMesh.isVerticesDataPresent(e)},t.prototype.getIndices=function(){return this._sourceMesh.getIndices()},Object.defineProperty(t.prototype,"_positions",{get:function(){return this._sourceMesh._positions},enumerable:!0,configurable:!0}),t.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var t=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;return this._refreshBoundingInfo(this._sourceMesh._getPositionData(e),t),this},t.prototype._preActivate=function(){return this._currentLOD&&this._currentLOD._preActivate(),this},t.prototype._activate=function(e,t){if(this._currentLOD&&this._currentLOD._registerInstanceForRenderId(this,e),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0;return!1},t.prototype._postActivate=function(){this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)},t.prototype.getWorldMatrix=function(){if(this._currentLOD&&this._currentLOD.billboardMode!==x.a.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){var t=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,i.o.Matrix[0].copyFrom(this._currentLOD.computeWorldMatrix(!0)),this._currentLOD._masterMesh=t,i.o.Matrix[0]}return e.prototype.getWorldMatrix.call(this)},Object.defineProperty(t.prototype,"isAnInstance",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.getLOD=function(e){if(!e)return this;var t=this.getBoundingInfo();return this._currentLOD=this.sourceMesh.getLOD(e,t.boundingSphere),this._currentLOD===this.sourceMesh?this.sourceMesh:this._currentLOD},t.prototype._syncSubMeshes=function(){if(this.releaseSubMeshes(),this._sourceMesh.subMeshes)for(var e=0;e<this._sourceMesh.subMeshes.length;e++)this._sourceMesh.subMeshes[e].clone(this,this._sourceMesh);return this},t.prototype._generatePointsArray=function(){return this._sourceMesh._generatePointsArray()},t.prototype.clone=function(e,t,r){var i=this._sourceMesh.createInstance(e);if(m.a.DeepCopy(this,i,["name","subMeshes","uniqueId"],[]),this.refreshBoundingInfo(),t&&(i.parent=t),!r)for(var n=0;n<this.getScene().meshes.length;n++){var o=this.getScene().meshes[n];o.parent===this&&o.clone(o.name,i)}return i.computeWorldMatrix(!0),i},t.prototype.dispose=function(t,r){void 0===r&&(r=!1),this._sourceMesh.removeInstance(this),e.prototype.dispose.call(this,t,r)},t}(g.a),C=r(12),A=r(4),w=r(21),P=r(15),O=r(6),M=r(26),S=function(e){function t(t,r,n,o){void 0===o&&(o={});var a=e.call(this,t,r)||this;return a._textures={},a._textureArrays={},a._floats={},a._ints={},a._floatsArrays={},a._colors3={},a._colors3Arrays={},a._colors4={},a._vectors2={},a._vectors3={},a._vectors4={},a._matrices={},a._matrices3x3={},a._matrices2x2={},a._vectors2Arrays={},a._vectors3Arrays={},a._cachedWorldViewMatrix=new i.g,a._shaderPath=n,a._options=y.a({needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],defines:[]},o),a}return y.c(t,e),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),t.prototype.getClassName=function(){return"ShaderMaterial"},t.prototype.needAlphaBlending=function(){return this.alpha<1||this._options.needAlphaBlending},t.prototype.needAlphaTesting=function(){return this._options.needAlphaTesting},t.prototype._checkUniform=function(e){-1===this._options.uniforms.indexOf(e)&&this._options.uniforms.push(e)},t.prototype.setTexture=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._textures[e]=t,this},t.prototype.setTextureArray=function(e,t){return-1===this._options.samplers.indexOf(e)&&this._options.samplers.push(e),this._checkUniform(e),this._textureArrays[e]=t,this},t.prototype.setFloat=function(e,t){return this._checkUniform(e),this._floats[e]=t,this},t.prototype.setInt=function(e,t){return this._checkUniform(e),this._ints[e]=t,this},t.prototype.setFloats=function(e,t){return this._checkUniform(e),this._floatsArrays[e]=t,this},t.prototype.setColor3=function(e,t){return this._checkUniform(e),this._colors3[e]=t,this},t.prototype.setColor3Array=function(e,t){return this._checkUniform(e),this._colors3Arrays[e]=t.reduce((function(e,t){return t.toArray(e,e.length),e}),[]),this},t.prototype.setColor4=function(e,t){return this._checkUniform(e),this._colors4[e]=t,this},t.prototype.setVector2=function(e,t){return this._checkUniform(e),this._vectors2[e]=t,this},t.prototype.setVector3=function(e,t){return this._checkUniform(e),this._vectors3[e]=t,this},t.prototype.setVector4=function(e,t){return this._checkUniform(e),this._vectors4[e]=t,this},t.prototype.setMatrix=function(e,t){return this._checkUniform(e),this._matrices[e]=t,this},t.prototype.setMatrix3x3=function(e,t){return this._checkUniform(e),this._matrices3x3[e]=t,this},t.prototype.setMatrix2x2=function(e,t){return this._checkUniform(e),this._matrices2x2[e]=t,this},t.prototype.setArray2=function(e,t){return this._checkUniform(e),this._vectors2Arrays[e]=t,this},t.prototype.setArray3=function(e,t){return this._checkUniform(e),this._vectors3Arrays[e]=t,this},t.prototype._checkCache=function(e,t){return!e||(this._effect&&this._effect.defines.indexOf("#define INSTANCES"),!1)},t.prototype.isReadyForSubMesh=function(e,t,r){return this.isReady(e,r)},t.prototype.isReady=function(e,t){var r=this.getScene(),i=r.getEngine();if(!this.checkReadyOnEveryCall&&this._renderId===r.getRenderId()&&this._checkCache(e,t))return!0;for(var n=[],a=[],s=new O.b,u=0;u<this._options.defines.length;u++)n.push(this._options.defines[u]);for(u=0;u<this._options.attributes.length;u++)a.push(this._options.attributes[u]);if(e&&e.isVerticesDataPresent(o.b.ColorKind)&&(a.push(o.b.ColorKind),n.push("#define VERTEXCOLOR")),t&&(n.push("#define INSTANCES"),P.a.PrepareAttributesForInstances(a,n)),e&&e.useBones&&e.computeBonesUsingShaders&&e.skeleton){a.push(o.b.MatricesIndicesKind),a.push(o.b.MatricesWeightsKind),e.numBoneInfluencers>4&&(a.push(o.b.MatricesIndicesExtraKind),a.push(o.b.MatricesWeightsExtraKind));var c=e.skeleton;n.push("#define NUM_BONE_INFLUENCERS "+e.numBoneInfluencers),s.addCPUSkinningFallback(0,e),c.isUsingTextureForMatrices?(n.push("#define BONETEXTURE"),-1===this._options.uniforms.indexOf("boneTextureWidth")&&this._options.uniforms.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(n.push("#define BonesPerMesh "+(c.bones.length+1)),-1===this._options.uniforms.indexOf("mBones")&&this._options.uniforms.push("mBones"))}else n.push("#define NUM_BONE_INFLUENCERS 0");for(var h in this._textures)if(!this._textures[h].isReady())return!1;e&&this._shouldTurnAlphaTestOn(e)&&n.push("#define ALPHATEST");var l=this._effect,f=n.join("\n");return this._effect=i.createEffect(this._shaderPath,{attributes:a,uniformsNames:this._options.uniforms,uniformBuffersNames:this._options.uniformBuffers,samplers:this._options.samplers,defines:f,fallbacks:s,onCompiled:this.onCompiled,onError:this.onError},i),!!this._effect.isReady()&&(l!==this._effect&&r.resetCachedMaterial(),this._renderId=r.getRenderId(),!0)},t.prototype.bindOnlyWorldMatrix=function(e){var t=this.getScene();this._effect&&(-1!==this._options.uniforms.indexOf("world")&&this._effect.setMatrix("world",e),-1!==this._options.uniforms.indexOf("worldView")&&(e.multiplyToRef(t.getViewMatrix(),this._cachedWorldViewMatrix),this._effect.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&this._effect.setMatrix("worldViewProjection",e.multiply(t.getTransformMatrix())))},t.prototype.bind=function(e,t){if(this.bindOnlyWorldMatrix(e),this._effect&&this.getScene().getCachedMaterial()!==this){var r;for(r in-1!==this._options.uniforms.indexOf("view")&&this._effect.setMatrix("view",this.getScene().getViewMatrix()),-1!==this._options.uniforms.indexOf("projection")&&this._effect.setMatrix("projection",this.getScene().getProjectionMatrix()),-1!==this._options.uniforms.indexOf("viewProjection")&&this._effect.setMatrix("viewProjection",this.getScene().getTransformMatrix()),P.a.BindBonesParameters(t,this._effect),this._textures)this._effect.setTexture(r,this._textures[r]);for(r in this._textureArrays)this._effect.setTextureArray(r,this._textureArrays[r]);for(r in this._ints)this._effect.setInt(r,this._ints[r]);for(r in this._floats)this._effect.setFloat(r,this._floats[r]);for(r in this._floatsArrays)this._effect.setArray(r,this._floatsArrays[r]);for(r in this._colors3)this._effect.setColor3(r,this._colors3[r]);for(r in this._colors3Arrays)this._effect.setArray3(r,this._colors3Arrays[r]);for(r in this._colors4){var i=this._colors4[r];this._effect.setFloat4(r,i.r,i.g,i.b,i.a)}for(r in this._vectors2)this._effect.setVector2(r,this._vectors2[r]);for(r in this._vectors3)this._effect.setVector3(r,this._vectors3[r]);for(r in this._vectors4)this._effect.setVector4(r,this._vectors4[r]);for(r in this._matrices)this._effect.setMatrix(r,this._matrices[r]);for(r in this._matrices3x3)this._effect.setMatrix3x3(r,this._matrices3x3[r]);for(r in this._matrices2x2)this._effect.setMatrix2x2(r,this._matrices2x2[r]);for(r in this._vectors2Arrays)this._effect.setArray2(r,this._vectors2Arrays[r]);for(r in this._vectors3Arrays)this._effect.setArray3(r,this._vectors3Arrays[r])}this._afterBind(t)},t.prototype.getActiveTextures=function(){var t=e.prototype.getActiveTextures.call(this);for(var r in this._textures)t.push(this._textures[r]);for(var r in this._textureArrays)for(var i=this._textureArrays[r],n=0;n<i.length;n++)t.push(i[n]);return t},t.prototype.hasTexture=function(t){if(e.prototype.hasTexture.call(this,t))return!0;for(var r in this._textures)if(this._textures[r]===t)return!0;for(var r in this._textureArrays)for(var i=this._textureArrays[r],n=0;n<i.length;n++)if(i[n]===t)return!0;return!1},t.prototype.clone=function(e){return new t(e,this.getScene(),this._shaderPath,this._options)},t.prototype.dispose=function(t,r,i){if(r){var n;for(n in this._textures)this._textures[n].dispose();for(n in this._textureArrays)for(var o=this._textureArrays[n],a=0;a<o.length;a++)o[a].dispose()}this._textures={},e.prototype.dispose.call(this,t,r,i)},t.prototype.serialize=function(){var e,t=A.a.Serialize(this);for(e in t.customType="BABYLON.ShaderMaterial",t.options=this._options,t.shaderPath=this._shaderPath,t.textures={},this._textures)t.textures[e]=this._textures[e].serialize();for(e in t.textureArrays={},this._textureArrays){t.textureArrays[e]=[];for(var r=this._textureArrays[e],i=0;i<r.length;i++)t.textureArrays[e].push(r[i].serialize())}for(e in t.floats={},this._floats)t.floats[e]=this._floats[e];for(e in t.FloatArrays={},this._floatsArrays)t.FloatArrays[e]=this._floatsArrays[e];for(e in t.colors3={},this._colors3)t.colors3[e]=this._colors3[e].asArray();for(e in t.colors3Arrays={},this._colors3Arrays)t.colors3Arrays[e]=this._colors3Arrays[e];for(e in t.colors4={},this._colors4)t.colors4[e]=this._colors4[e].asArray();for(e in t.vectors2={},this._vectors2)t.vectors2[e]=this._vectors2[e].asArray();for(e in t.vectors3={},this._vectors3)t.vectors3[e]=this._vectors3[e].asArray();for(e in t.vectors4={},this._vectors4)t.vectors4[e]=this._vectors4[e].asArray();for(e in t.matrices={},this._matrices)t.matrices[e]=this._matrices[e].asArray();for(e in t.matrices3x3={},this._matrices3x3)t.matrices3x3[e]=this._matrices3x3[e];for(e in t.matrices2x2={},this._matrices2x2)t.matrices2x2[e]=this._matrices2x2[e];for(e in t.vectors2Arrays={},this._vectors2Arrays)t.vectors2Arrays[e]=this._vectors2Arrays[e];for(e in t.vectors3Arrays={},this._vectors3Arrays)t.vectors3Arrays[e]=this._vectors3Arrays[e];return t},t.Parse=function(e,r,n){var o,a=A.a.Parse((function(){return new t(e.name,r,e.shaderPath,e.options)}),e,r,n);for(o in e.textures)a.setTexture(o,w.a.Parse(e.textures[o],r,n));for(o in e.textureArrays){for(var s=e.textureArrays[o],u=new Array,c=0;c<s.length;c++)u.push(w.a.Parse(s[c],r,n));a.setTextureArray(o,u)}for(o in e.floats)a.setFloat(o,e.floats[o]);for(o in e.floatsArrays)a.setFloats(o,e.floatsArrays[o]);for(o in e.colors3)a.setColor3(o,i.c.FromArray(e.colors3[o]));for(o in e.colors3Arrays){var h=e.colors3Arrays[o].reduce((function(e,t,r){return r%3==0?e.push([t]):e[e.length-1].push(t),e}),[]).map((function(e){return i.c.FromArray(e)}));a.setColor3Array(o,h)}for(o in e.colors4)a.setColor4(o,i.d.FromArray(e.colors4[o]));for(o in e.vectors2)a.setVector2(o,i.q.FromArray(e.vectors2[o]));for(o in e.vectors3)a.setVector3(o,i.r.FromArray(e.vectors3[o]));for(o in e.vectors4)a.setVector4(o,i.s.FromArray(e.vectors4[o]));for(o in e.matrices)a.setMatrix(o,i.g.FromArray(e.matrices[o]));for(o in e.matrices3x3)a.setMatrix3x3(o,e.matrices3x3[o]);for(o in e.matrices2x2)a.setMatrix2x2(o,e.matrices2x2[o]);for(o in e.vectors2Arrays)a.setArray2(o,e.vectors2Arrays[o]);for(o in e.vectors3Arrays)a.setArray3(o,e.vectors3Arrays[o]);return a},t}(C.a);M.a.RegisteredTypes["BABYLON.ShaderMaterial"]=S;r(45),r(47);var D="#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#else\nuniform vec4 color;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvoid main(void) {\n#include<clipPlaneFragment>\n#ifdef VERTEXCOLOR\ngl_FragColor=vColor;\n#else\ngl_FragColor=color;\n#endif\n}";O.a.ShadersStore.colorPixelShader=D;r(49),r(51),r(50),r(53),r(54),r(55);var T="\nattribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<bonesDeclaration>\n#include<clipPlaneVertexDeclaration>\n\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\n\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\nvoid main(void) {\n#include<instancesVertex>\n#include<bonesVertex>\nvec4 worldPos=finalWorld*vec4(position,1.0);\ngl_Position=viewProjection*worldPos;\n#include<clipPlaneVertex>\n#ifdef VERTEXCOLOR\n\nvColor=color;\n#endif\n}";O.a.ShadersStore.colorVertexShader=T;var V=function(e){function t(t,r,n,a,s,u,c){void 0===r&&(r=null),void 0===n&&(n=null);var h=e.call(this,t,r,n,a,s)||this;h.useVertexColor=u,h.useVertexAlpha=c,h.color=new i.c(1,1,1),h.alpha=1,a&&(h.color=a.color.clone(),h.alpha=a.alpha,h.useVertexColor=a.useVertexColor,h.useVertexAlpha=a.useVertexAlpha),h.intersectionThreshold=.1;var l={attributes:[o.b.PositionKind,"world0","world1","world2","world3"],uniforms:["vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","world","viewProjection"],needAlphaBlending:!0,defines:[]};return!1===c&&(l.needAlphaBlending=!1),u?(l.defines.push("#define VERTEXCOLOR"),l.attributes.push(o.b.ColorKind)):l.uniforms.push("color"),h._colorShader=new S("colorShader",h.getScene(),"color",l),h}return y.c(t,e),t.prototype._addClipPlaneDefine=function(e){var t="#define "+e;-1===this._colorShader.options.defines.indexOf(t)&&this._colorShader.options.defines.push(t)},t.prototype._removeClipPlaneDefine=function(e){var t="#define "+e,r=this._colorShader.options.defines.indexOf(t);-1!==r&&this._colorShader.options.defines.splice(r,1)},t.prototype.isReady=function(){var t=this.getScene();return t.clipPlane?this._addClipPlaneDefine("CLIPPLANE"):this._removeClipPlaneDefine("CLIPPLANE"),t.clipPlane2?this._addClipPlaneDefine("CLIPPLANE2"):this._removeClipPlaneDefine("CLIPPLANE2"),t.clipPlane3?this._addClipPlaneDefine("CLIPPLANE3"):this._removeClipPlaneDefine("CLIPPLANE3"),t.clipPlane4?this._addClipPlaneDefine("CLIPPLANE4"):this._removeClipPlaneDefine("CLIPPLANE4"),!!this._colorShader.isReady()&&e.prototype.isReady.call(this)},t.prototype.getClassName=function(){return"LinesMesh"},Object.defineProperty(t.prototype,"material",{get:function(){return this._colorShader},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkCollisions",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype._bind=function(e,t,r){if(!this._geometry)return this;var i=this._colorShader.getEffect(),n=this.isUnIndexed?null:this._geometry.getIndexBuffer();return this._geometry._bind(i,n),this.useVertexColor||this._colorShader.setColor4("color",this.color.toColor4(this.alpha)),P.a.BindClipPlane(i,this.getScene()),this},t.prototype._draw=function(e,t,r){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var i=this.getScene().getEngine();return this._unIndexed?i.drawArraysType(C.a.LineListDrawMode,e.verticesStart,e.verticesCount,r):i.drawElementsType(C.a.LineListDrawMode,e.indexStart,e.indexCount,r),this},t.prototype.dispose=function(t){this._colorShader.dispose(!1,!1,!0),e.prototype.dispose.call(this,t)},t.prototype.clone=function(e,r,i){return new t(e,this.getScene(),r,this,i)},t.prototype.createInstance=function(e){return new z(e,this)},t}(n.a),z=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.intersectionThreshold=r.intersectionThreshold,i}return y.c(t,e),t.prototype.getClassName=function(){return"InstancedLinesMesh"},t}(b);a.a.CreateLineSystem=function(e){for(var t=[],r=[],i=e.lines,n=e.colors,o=[],s=0,u=0;u<i.length;u++)for(var c=i[u],h=0;h<c.length;h++){if(r.push(c[h].x,c[h].y,c[h].z),n){var l=n[u];o.push(l[h].r,l[h].g,l[h].b,l[h].a)}h>0&&(t.push(s-1),t.push(s)),s++}var f=new a.a;return f.indices=t,f.positions=r,n&&(f.colors=o),f},a.a.CreateDashedLines=function(e){var t,r,n=e.dashSize||3,o=e.gapSize||1,s=e.dashNb||200,u=e.points,c=new Array,h=new Array,l=i.r.Zero(),f=0,d=0,p=0,v=0,y=0;for(y=0;y<u.length-1;y++)u[y+1].subtractToRef(u[y],l),f+=l.length();for(r=n*(t=f/s)/(n+o),y=0;y<u.length-1;y++){u[y+1].subtractToRef(u[y],l),d=Math.floor(l.length()/t),l.normalize();for(var _=0;_<d;_++)p=t*_,c.push(u[y].x+p*l.x,u[y].y+p*l.y,u[y].z+p*l.z),c.push(u[y].x+(p+r)*l.x,u[y].y+(p+r)*l.y,u[y].z+(p+r)*l.z),h.push(v,v+1),v+=2}var g=new a.a;return g.positions=c,g.indices=h,g},n.a.CreateLines=function(e,t,r,i,n){void 0===r&&(r=null),void 0===i&&(i=!1),void 0===n&&(n=null);var o={points:t,updatable:i,instance:n};return I.CreateLines(e,o,r)},n.a.CreateDashedLines=function(e,t,r,i,n,o,a,s){void 0===o&&(o=null);var u={points:t,dashSize:r,gapSize:i,dashNb:n,updatable:a,instance:s};return I.CreateDashedLines(e,u,o)};var I=function(){function e(){}return e.CreateLineSystem=function(e,t,r){var i=t.instance,n=t.lines,s=t.colors;if(i){var u,c,h=i.getVerticesData(o.b.PositionKind);s&&(u=i.getVerticesData(o.b.ColorKind));for(var l=0,f=0,d=0;d<n.length;d++)for(var p=n[d],v=0;v<p.length;v++)h[l]=p[v].x,h[l+1]=p[v].y,h[l+2]=p[v].z,s&&u&&(c=s[d],u[f]=c[v].r,u[f+1]=c[v].g,u[f+2]=c[v].b,u[f+3]=c[v].a,f+=4),l+=3;return i.updateVerticesData(o.b.PositionKind,h,!1,!1),s&&u&&i.updateVerticesData(o.b.ColorKind,u,!1,!1),i}var y=new V(e,r,null,void 0,void 0,!!s,t.useVertexAlpha);return a.a.CreateLineSystem(t).applyToMesh(y,t.updatable),y},e.CreateLines=function(t,r,i){void 0===i&&(i=null);var n=r.colors?[r.colors]:null;return e.CreateLineSystem(t,{lines:[r.points],updatable:r.updatable,instance:r.instance,colors:n,useVertexAlpha:r.useVertexAlpha},i)},e.CreateDashedLines=function(e,t,r){void 0===r&&(r=null);var o=t.points,s=t.instance,u=t.gapSize||1,c=t.dashSize||3;if(s){return s.updateMeshPositions((function(e){var t,r,n=i.r.Zero(),a=e.length/6,u=0,c=0,h=0,l=0,f=0,d=0;for(f=0;f<o.length-1;f++)o[f+1].subtractToRef(o[f],n),u+=n.length();t=u/a;var p=s._creationDataStorage.dashSize;for(r=p*t/(p+s._creationDataStorage.gapSize),f=0;f<o.length-1;f++)for(o[f+1].subtractToRef(o[f],n),c=Math.floor(n.length()/t),n.normalize(),d=0;d<c&&l<e.length;)h=t*d,e[l]=o[f].x+h*n.x,e[l+1]=o[f].y+h*n.y,e[l+2]=o[f].z+h*n.z,e[l+3]=o[f].x+(h+r)*n.x,e[l+4]=o[f].y+(h+r)*n.y,e[l+5]=o[f].z+(h+r)*n.z,l+=6,d++;for(;l<e.length;)e[l]=o[f].x,e[l+1]=o[f].y,e[l+2]=o[f].z,l+=3}),!1),s}var h=new V(e,r);return a.a.CreateDashedLines(t).applyToMesh(h,t.updatable),h._creationDataStorage=new n.b,h._creationDataStorage.dashSize=c,h._creationDataStorage.gapSize=u,h},e}(),L=r(42),E=r(25);a.a.CreatePolygon=function(e,t,r,n,s,u){for(var c=r||new Array(3),h=n,l=[],f=0;f<3;f++)void 0===c[f]&&(c[f]=new i.s(0,0,1,1)),h&&void 0===h[f]&&(h[f]=new i.d(1,1,1,1));for(var d=e.getVerticesData(o.b.PositionKind),p=e.getVerticesData(o.b.NormalKind),v=e.getVerticesData(o.b.UVKind),y=e.getIndices(),_=0,g=0,m=0;m<p.length;m+=3)Math.abs(p[m+1])<.001&&(g=1),Math.abs(p[m+1]-1)<.001&&(g=0),Math.abs(p[m+1]+1)<.001&&(g=2),v[2*(_=m/3)]=(1-v[2*_])*c[g].x+v[2*_]*c[g].z,v[2*_+1]=(1-v[2*_+1])*c[g].y+v[2*_+1]*c[g].w,h&&l.push(h[g].r,h[g].g,h[g].b,h[g].a);a.a._ComputeSides(t,d,y,p,v,s,u);var x=new a.a;if(x.indices=y,x.positions=d,x.normals=p,x.uvs=v,h){var b=t===a.a.DOUBLESIDE?l.concat(l):l;x.colors=b}return x},n.a.CreatePolygon=function(e,t,r,i,n,o,a){void 0===a&&(a=earcut);var s={shape:t,holes:i,updatable:n,sideOrientation:o};return U.CreatePolygon(e,s,r,a)},n.a.ExtrudePolygon=function(e,t,r,i,n,o,a,s){void 0===s&&(s=earcut);var u={shape:t,holes:n,depth:r,updatable:o,sideOrientation:a};return U.ExtrudePolygon(e,u,i,s)};var U=function(){function e(){}return e.CreatePolygon=function(e,t,r,o){void 0===r&&(r=null),void 0===o&&(o=earcut),t.sideOrientation=n.a._GetDefaultSideOrientation(t.sideOrientation);for(var s=t.shape,u=t.holes||[],c=t.depth||0,h=[],l=[],f=0;f<s.length;f++)h[f]=new i.q(s[f].x,s[f].z);h[0].equalsWithEpsilon(h[h.length-1],1e-8)&&h.pop();for(var d=new L.b(e,h,r||E.a.LastCreatedScene,o),p=0;p<u.length;p++){l=[];for(var v=0;v<u[p].length;v++)l.push(new i.q(u[p][v].x,u[p][v].z));d.addHole(l)}var y=d.build(t.updatable,c);return y._originalBuilderSideOrientation=t.sideOrientation,a.a.CreatePolygon(y,t.sideOrientation,t.faceUV,t.faceColors,t.frontUVs,t.backUVs).applyToMesh(y,t.updatable),y},e.ExtrudePolygon=function(t,r,i,n){return void 0===i&&(i=null),void 0===n&&(n=earcut),e.CreatePolygon(t,r,i,n)},e}();n.a.ExtrudeShape=function(e,t,r,i,o,a,s,u,c,h){void 0===s&&(s=null);var l={shape:t,path:r,scale:i,rotation:o,cap:0===a?0:a||n.a.NO_CAP,sideOrientation:c,instance:h,updatable:u};return F.ExtrudeShape(e,l,s)},n.a.ExtrudeShapeCustom=function(e,t,r,i,o,a,s,u,c,h,l,f){var d={shape:t,path:r,scaleFunction:i,rotationFunction:o,ribbonCloseArray:a,ribbonClosePath:s,cap:0===u?0:u||n.a.NO_CAP,sideOrientation:l,instance:f,updatable:h};return F.ExtrudeShapeCustom(e,d,c)};var F=function(){function e(){}return e.ExtrudeShape=function(t,r,i){void 0===i&&(i=null);var o=r.path,a=r.shape,s=r.scale||1,u=r.rotation||0,c=0===r.cap?0:r.cap||n.a.NO_CAP,h=r.updatable,l=n.a._GetDefaultSideOrientation(r.sideOrientation),f=r.instance||null,d=r.invertUV||!1;return e._ExtrudeShapeGeneric(t,a,o,s,u,null,null,!1,!1,c,!1,i,!!h,l,f,d,r.frontUVs||null,r.backUVs||null)},e.ExtrudeShapeCustom=function(t,r,i){void 0===i&&(i=null);var o=r.path,a=r.shape,s=r.scaleFunction||function(){return 1},u=r.rotationFunction||function(){return 0},c=r.ribbonCloseArray||!1,h=r.ribbonClosePath||!1,l=0===r.cap?0:r.cap||n.a.NO_CAP,f=r.updatable,d=n.a._GetDefaultSideOrientation(r.sideOrientation),p=r.instance,v=r.invertUV||!1;return e._ExtrudeShapeGeneric(t,a,o,null,null,s,u,c,h,l,!0,i,!!f,d,p||null,v,r.frontUVs||null,r.backUVs||null)},e._ExtrudeShapeGeneric=function(e,t,r,o,a,s,c,h,l,f,d,p,v,y,_,g,m,x){var b,C,A=function(e,t,r,o,a,s,u,c,h,l){for(var f=r.getTangents(),d=r.getNormals(),p=r.getBinormals(),v=r.getDistances(),y=0,_=l&&c?c:function(){return null!==s?s:0},g=l&&u?u:function(){return null!==a?a:1},m=h===n.a.NO_CAP||h===n.a.CAP_END?0:2,x=i.o.Matrix[0],b=0;b<t.length;b++){for(var C=new Array,A=_(b,v[b]),w=g(b,v[b]),P=0;P<e.length;P++){i.g.RotationAxisToRef(f[b],y,x);var O=f[b].scale(e[P].z).add(d[b].scale(e[P].x)).add(p[b].scale(e[P].y)),M=C[P]?C[P]:i.r.Zero();i.r.TransformCoordinatesToRef(O,x,M),M.scaleInPlace(w).addInPlace(t[b]),C[P]=M}o[m]=C,y+=A,m++}var S=function(e){var t,r=Array(),n=i.r.Zero();for(t=0;t<e.length;t++)n.addInPlace(e[t]);for(n.scaleInPlace(1/e.length),t=0;t<e.length;t++)r.push(n);return r};switch(h){case n.a.NO_CAP:break;case n.a.CAP_START:o[0]=S(o[2]),o[1]=o[2];break;case n.a.CAP_END:o[m]=o[m-1],o[m+1]=S(o[m-1]);break;case n.a.CAP_ALL:o[0]=S(o[2]),o[1]=o[2],o[m]=o[m-1],o[m+1]=S(o[m-1])}return o};if(_){var w=_._creationDataStorage;return b=w.path3D.update(r),C=A(t,r,w.path3D,w.pathArray,o,a,s,c,w.cap,d),_=n.a.CreateRibbon("",C,!1,!1,0,p||void 0,!1,0,_)}C=A(t,r,b=new i.i(r),new Array,o,a,s,c,f=f<0||f>3?0:f,d);var P=u.CreateRibbon(e,{pathArray:C,closeArray:h,closePath:l,updatable:v,sideOrientation:y,invertUV:g,frontUVs:m||void 0,backUVs:x||void 0},p);return P._creationDataStorage.pathArray=C,P._creationDataStorage.path3D=b,P._creationDataStorage.cap=f,P},e}();n.a.CreateLathe=function(e,t,r,i,n,o,a){var s={shape:t,radius:r,tessellation:i,sideOrientation:a,updatable:o};return R.CreateLathe(e,s,n)};var R=function(){function e(){}return e.CreateLathe=function(e,t,r){void 0===r&&(r=null);var o,a=t.arc?t.arc<=0||t.arc>1?1:t.arc:1,s=void 0===t.closed||t.closed,c=t.shape,h=t.radius||1,l=t.tessellation||64,f=t.clip||0,d=t.updatable,p=n.a._GetDefaultSideOrientation(t.sideOrientation),v=t.cap||n.a.NO_CAP,y=2*Math.PI,_=new Array,g=t.invertUV||!1,m=0,x=0,b=y/l*a,C=new Array;for(m=0;m<=l-f;m++){C=[];for(v!=n.a.CAP_START&&v!=n.a.CAP_ALL||(C.push(new i.r(0,c[0].y,0)),C.push(new i.r(Math.cos(m*b)*c[0].x*h,c[0].y,Math.sin(m*b)*c[0].x*h))),x=0;x<c.length;x++)o=new i.r(Math.cos(m*b)*c[x].x*h,c[x].y,Math.sin(m*b)*c[x].x*h),C.push(o);v!=n.a.CAP_END&&v!=n.a.CAP_ALL||(C.push(new i.r(Math.cos(m*b)*c[c.length-1].x*h,c[c.length-1].y,Math.sin(m*b)*c[c.length-1].x*h)),C.push(new i.r(0,c[c.length-1].y,0))),_.push(C)}return u.CreateRibbon(e,{pathArray:_,closeArray:s,sideOrientation:p,updatable:d,invertUV:g,frontUVs:t.frontUVs,backUVs:t.backUVs},r)},e}();a.a.CreatePlane=function(e){var t=[],r=[],i=[],n=[],o=e.width||e.size||1,s=e.height||e.size||1,u=0===e.sideOrientation?0:e.sideOrientation||a.a.DEFAULTSIDE,c=o/2,h=s/2;r.push(-c,-h,0),i.push(0,0,-1),n.push(0,0),r.push(c,-h,0),i.push(0,0,-1),n.push(1,0),r.push(c,h,0),i.push(0,0,-1),n.push(1,1),r.push(-c,h,0),i.push(0,0,-1),n.push(0,1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),a.a._ComputeSides(u,r,t,i,n,e.frontUVs,e.backUVs);var l=new a.a;return l.indices=t,l.positions=r,l.normals=i,l.uvs=n,l},n.a.CreatePlane=function(e,t,r,i,n){var o={size:t,width:t,height:t,sideOrientation:n,updatable:i};return N.CreatePlane(e,o,r)};var N=function(){function e(){}return e.CreatePlane=function(e,t,r){void 0===r&&(r=null);var i=new n.a(e,r);return t.sideOrientation=n.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,a.a.CreatePlane(t).applyToMesh(i,t.updatable),t.sourcePlane&&(i.translate(t.sourcePlane.normal,-t.sourcePlane.d),i.setDirection(t.sourcePlane.normal.scale(-1))),i},e}();n.a._GroundMeshParser=function(e,t){return B.Parse(e,t)};var B=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.generateOctree=!1,i}return y.c(t,e),t.prototype.getClassName=function(){return"GroundMesh"},Object.defineProperty(t.prototype,"subdivisions",{get:function(){return Math.min(this._subdivisionsX,this._subdivisionsY)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsX",{get:function(){return this._subdivisionsX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"subdivisionsY",{get:function(){return this._subdivisionsY},enumerable:!0,configurable:!0}),t.prototype.optimize=function(e,t){void 0===t&&(t=32),this._subdivisionsX=e,this._subdivisionsY=e,this.subdivide(e);this.createOrUpdateSubmeshesOctree&&this.createOrUpdateSubmeshesOctree(t)},t.prototype.getHeightAtCoordinates=function(e,t){var r=this.getWorldMatrix(),n=i.o.Matrix[5];r.invertToRef(n);var o=i.o.Vector3[8];if(i.r.TransformCoordinatesFromFloatsToRef(e,0,t,n,o),e=o.x,t=o.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var a=this._getFacetAt(e,t),s=-(a.x*e+a.z*t+a.w)/a.y;return i.r.TransformCoordinatesFromFloatsToRef(0,s,0,r,o),o.y},t.prototype.getNormalAtCoordinates=function(e,t){var r=new i.r(0,1,0);return this.getNormalAtCoordinatesToRef(e,t,r),r},t.prototype.getNormalAtCoordinatesToRef=function(e,t,r){var n=this.getWorldMatrix(),o=i.o.Matrix[5];n.invertToRef(o);var a=i.o.Vector3[8];if(i.r.TransformCoordinatesFromFloatsToRef(e,0,t,o,a),e=a.x,t=a.z,e<this._minX||e>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());var s=this._getFacetAt(e,t);return i.r.TransformNormalFromFloatsToRef(s.x,s.y,s.z,n,r),this},t.prototype.updateCoordinateHeights=function(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this},t.prototype._getFacetAt=function(e,t){var r=Math.floor((e+this._maxX)*this._subdivisionsX/this._width),i=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),n=this._heightQuads[i*this._subdivisionsX+r];return t<n.slope.x*e+n.slope.y?n.facet1:n.facet2},t.prototype._initHeightQuads=function(){var e=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(var r=0;r<t;r++)for(var n=0;n<e;n++){var o={slope:i.q.Zero(),facet1:new i.s(0,0,0,0),facet2:new i.s(0,0,0,0)};this._heightQuads[r*e+n]=o}return this},t.prototype._computeHeightQuads=function(){var e=this.getVerticesData(o.b.PositionKind);if(!e)return this;for(var t=i.o.Vector3[3],r=i.o.Vector3[2],n=i.o.Vector3[1],a=i.o.Vector3[0],s=i.o.Vector3[4],u=i.o.Vector3[5],c=i.o.Vector3[6],h=i.o.Vector3[7],l=i.o.Vector3[8],f=0,d=0,p=0,v=0,y=0,_=0,g=0,m=this._subdivisionsX,x=this._subdivisionsY,b=0;b<x;b++)for(var C=0;C<m;C++){f=3*C,d=b*(m+1)*3,p=(b+1)*(m+1)*3,t.x=e[d+f],t.y=e[d+f+1],t.z=e[d+f+2],r.x=e[d+f+3],r.y=e[d+f+4],r.z=e[d+f+5],n.x=e[p+f],n.y=e[p+f+1],n.z=e[p+f+2],a.x=e[p+f+3],a.y=e[p+f+4],a.z=e[p+f+5],v=(a.z-t.z)/(a.x-t.x),y=t.z-v*t.x,r.subtractToRef(t,s),n.subtractToRef(t,u),a.subtractToRef(t,c),i.r.CrossToRef(c,u,h),i.r.CrossToRef(s,c,l),h.normalize(),l.normalize(),_=-(h.x*t.x+h.y*t.y+h.z*t.z),g=-(l.x*r.x+l.y*r.y+l.z*r.z);var A=this._heightQuads[b*m+C];A.slope.copyFromFloats(v,y),A.facet1.copyFromFloats(h.x,h.y,h.z,_),A.facet2.copyFromFloats(l.x,l.y,l.z,g)}return this},t.prototype.serialize=function(t){e.prototype.serialize.call(this,t),t.subdivisionsX=this._subdivisionsX,t.subdivisionsY=this._subdivisionsY,t.minX=this._minX,t.maxX=this._maxX,t.minZ=this._minZ,t.maxZ=this._maxZ,t.width=this._width,t.height=this._height},t.Parse=function(e,r){var i=new t(e.name,r);return i._subdivisionsX=e.subdivisionsX||1,i._subdivisionsY=e.subdivisionsY||1,i._minX=e.minX,i._maxX=e.maxX,i._minZ=e.minZ,i._maxZ=e.maxZ,i._width=e.width,i._height=e.height,i},t}(n.a),k=r(7);a.a.CreateGround=function(e){var t,r,n=[],o=[],s=[],u=[],c=e.width||1,h=e.height||1,l=e.subdivisionsX||e.subdivisions||1,f=e.subdivisionsY||e.subdivisions||1;for(t=0;t<=f;t++)for(r=0;r<=l;r++){var d=new i.r(r*c/l-c/2,0,(f-t)*h/f-h/2),p=new i.r(0,1,0);o.push(d.x,d.y,d.z),s.push(p.x,p.y,p.z),u.push(r/l,1-t/f)}for(t=0;t<f;t++)for(r=0;r<l;r++)n.push(r+1+(t+1)*(l+1)),n.push(r+1+t*(l+1)),n.push(r+t*(l+1)),n.push(r+(t+1)*(l+1)),n.push(r+1+(t+1)*(l+1)),n.push(r+t*(l+1));var v=new a.a;return v.indices=n,v.positions=o,v.normals=s,v.uvs=u,v},a.a.CreateTiledGround=function(e){var t,r,n,o,s=void 0!==e.xmin&&null!==e.xmin?e.xmin:-1,u=void 0!==e.zmin&&null!==e.zmin?e.zmin:-1,c=void 0!==e.xmax&&null!==e.xmax?e.xmax:1,h=void 0!==e.zmax&&null!==e.zmax?e.zmax:1,l=e.subdivisions||{w:1,h:1},f=e.precision||{w:1,h:1},d=new Array,p=new Array,v=new Array,y=new Array;l.h=l.h<1?1:l.h,l.w=l.w<1?1:l.w,f.w=f.w<1?1:f.w,f.h=f.h<1?1:f.h;var _=(c-s)/l.w,g=(h-u)/l.h;function m(e,n,o,a){var s=p.length/3,u=f.w+1;for(t=0;t<f.h;t++)for(r=0;r<f.w;r++){var c=[s+r+t*u,s+(r+1)+t*u,s+(r+1)+(t+1)*u,s+r+(t+1)*u];d.push(c[1]),d.push(c[2]),d.push(c[3]),d.push(c[0]),d.push(c[1]),d.push(c[3])}var h=i.r.Zero(),l=new i.r(0,1,0);for(t=0;t<=f.h;t++)for(h.z=t*(a-n)/f.h+n,r=0;r<=f.w;r++)h.x=r*(o-e)/f.w+e,h.y=0,p.push(h.x,h.y,h.z),v.push(l.x,l.y,l.z),y.push(r/f.w,t/f.h)}for(n=0;n<l.h;n++)for(o=0;o<l.w;o++)m(s+o*_,u+n*g,s+(o+1)*_,u+(n+1)*g);var x=new a.a;return x.indices=d,x.positions=p,x.normals=v,x.uvs=y,x},a.a.CreateGroundFromHeightMap=function(e){var t,r,n=[],o=[],s=[],u=[],c=e.colorFilter||new i.c(.3,.59,.11),h=e.alphaFilter||0,l=!1;if(e.minHeight>e.maxHeight){l=!0;var f=e.maxHeight;e.maxHeight=e.minHeight,e.minHeight=f}for(t=0;t<=e.subdivisions;t++)for(r=0;r<=e.subdivisions;r++){var d=new i.r(r*e.width/e.subdivisions-e.width/2,0,(e.subdivisions-t)*e.height/e.subdivisions-e.height/2),p=4*(((d.x+e.width/2)/e.width*(e.bufferWidth-1)|0)+((1-(d.z+e.height/2)/e.height)*(e.bufferHeight-1)|0)*e.bufferWidth),v=e.buffer[p]/255,y=e.buffer[p+1]/255,_=e.buffer[p+2]/255,g=e.buffer[p+3]/255;l&&(v=1-v,y=1-y,_=1-_);var m=v*c.r+y*c.g+_*c.b;d.y=g>=h?e.minHeight+(e.maxHeight-e.minHeight)*m:e.minHeight-i.e,o.push(d.x,d.y,d.z),s.push(0,0,0),u.push(r/e.subdivisions,1-t/e.subdivisions)}for(t=0;t<e.subdivisions;t++)for(r=0;r<e.subdivisions;r++){var x=r+1+(t+1)*(e.subdivisions+1),b=r+1+t*(e.subdivisions+1),C=r+t*(e.subdivisions+1),A=r+(t+1)*(e.subdivisions+1),w=o[3*x+1]>=e.minHeight,P=o[3*b+1]>=e.minHeight,O=o[3*C+1]>=e.minHeight;w&&P&&O&&(n.push(x),n.push(b),n.push(C)),o[3*A+1]>=e.minHeight&&w&&O&&(n.push(A),n.push(x),n.push(C))}a.a.ComputeNormals(o,n,s);var M=new a.a;return M.indices=n,M.positions=o,M.normals=s,M.uvs=u,M},n.a.CreateGround=function(e,t,r,i,n,o){var a={width:t,height:r,subdivisions:i,updatable:o};return G.CreateGround(e,a,n)},n.a.CreateTiledGround=function(e,t,r,i,n,o,a,s,u){var c={xmin:t,zmin:r,xmax:i,zmax:n,subdivisions:o,precision:a,updatable:u};return G.CreateTiledGround(e,c,s)},n.a.CreateGroundFromHeightMap=function(e,t,r,i,n,o,a,s,u,c,h){var l={width:r,height:i,subdivisions:n,minHeight:o,maxHeight:a,updatable:u,onReady:c,alphaFilter:h};return G.CreateGroundFromHeightMap(e,t,l,s)};var G=function(){function e(){}return e.CreateGround=function(e,t,r){var i=new B(e,r);return i._setReady(!1),i._subdivisionsX=t.subdivisionsX||t.subdivisions||1,i._subdivisionsY=t.subdivisionsY||t.subdivisions||1,i._width=t.width||1,i._height=t.height||1,i._maxX=i._width/2,i._maxZ=i._height/2,i._minX=-i._maxX,i._minZ=-i._maxZ,a.a.CreateGround(t).applyToMesh(i,t.updatable),i._setReady(!0),i},e.CreateTiledGround=function(e,t,r){void 0===r&&(r=null);var i=new n.a(e,r);return a.a.CreateTiledGround(t).applyToMesh(i,t.updatable),i},e.CreateGroundFromHeightMap=function(e,t,r,n){void 0===n&&(n=null);var o=r.width||10,s=r.height||10,u=r.subdivisions||1,c=r.minHeight||0,h=r.maxHeight||1,l=r.colorFilter||new i.c(.3,.59,.11),f=r.alphaFilter||0,d=r.updatable,p=r.onReady;n=n||E.a.LastCreatedScene;var v=new B(e,n);v._subdivisionsX=u,v._subdivisionsY=u,v._width=o,v._height=s,v._maxX=v._width/2,v._maxZ=v._height/2,v._minX=-v._maxX,v._minZ=-v._maxZ,v._setReady(!1);return k.c.LoadImage(t,(function(e){var t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("Unable to get 2d context for CreateGroundFromHeightMap");if(!n.isDisposed){var i=e.width,y=e.height;t.width=i,t.height=y,r.drawImage(e,0,0);var _=r.getImageData(0,0,i,y).data;a.a.CreateGroundFromHeightMap({width:o,height:s,subdivisions:u,minHeight:c,maxHeight:h,colorFilter:l,buffer:_,bufferWidth:i,bufferHeight:y,alphaFilter:f}).applyToMesh(v,d),p&&p(v),v._setReady(!0)}}),(function(){}),n.offlineProvider),v},e}();n.a.CreateTube=function(e,t,r,i,n,o,a,s,u,c){var h={path:t,radius:r,tessellation:i,radiusFunction:n,arc:1,cap:o,updatable:s,sideOrientation:u,instance:c};return j.CreateTube(e,h,a)};var j=function(){function e(){}return e.CreateTube=function(e,t,r){void 0===r&&(r=null);var o=t.path,a=t.instance,s=1;void 0!==t.radius?s=t.radius:a&&(s=a._creationDataStorage.radius);var c=t.tessellation||64,h=t.radiusFunction||null,l=t.cap||n.a.NO_CAP,f=t.invertUV||!1,d=t.updatable,p=n.a._GetDefaultSideOrientation(t.sideOrientation);t.arc=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1;var v,y,_=function(e,t,r,o,a,s,u,c){for(var h,l,f,d,p=t.getTangents(),v=t.getNormals(),y=t.getDistances(),_=2*Math.PI/a*c,g=s||function(){return o},m=i.o.Matrix[0],x=u===n.a.NO_CAP||u===n.a.CAP_END?0:2,b=0;b<e.length;b++){l=g(b,y[b]),h=Array(),f=v[b];for(var C=0;C<a;C++)i.g.RotationAxisToRef(p[b],_*C,m),d=h[C]?h[C]:i.r.Zero(),i.r.TransformCoordinatesToRef(f,m,d),d.scaleInPlace(l).addInPlace(e[b]),h[C]=d;r[x]=h,x++}var A=function(t,r){for(var i=Array(),n=0;n<t;n++)i.push(e[r]);return i};switch(u){case n.a.NO_CAP:break;case n.a.CAP_START:r[0]=A(a,0),r[1]=r[2].slice(0);break;case n.a.CAP_END:r[x]=r[x-1].slice(0),r[x+1]=A(a,e.length-1);break;case n.a.CAP_ALL:r[0]=A(a,0),r[1]=r[2].slice(0),r[x]=r[x-1].slice(0),r[x+1]=A(a,e.length-1)}return r};if(a){var g=a._creationDataStorage,m=t.arc||g.arc;return y=_(o,v=g.path3D.update(o),g.pathArray,s,g.tessellation,h,g.cap,m),a=u.CreateRibbon("",{pathArray:y,instance:a}),g.path3D=v,g.pathArray=y,g.arc=m,g.radius=s,a}y=_(o,v=new i.i(o),new Array,s,c,h,l=l<0||l>3?0:l,t.arc);var x=u.CreateRibbon(e,{pathArray:y,closePath:!0,closeArray:!1,updatable:d,sideOrientation:p,invertUV:f,frontUVs:t.frontUVs,backUVs:t.backUVs},r);return x._creationDataStorage.pathArray=y,x._creationDataStorage.path3D=v,x._creationDataStorage.tessellation=c,x._creationDataStorage.cap=l,x._creationDataStorage.arc=t.arc,x._creationDataStorage.radius=s,x},e}();a.a.CreatePolyhedron=function(e){var t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};var r,n,o,s,u,c,h=e.type&&(e.type<0||e.type>=t.length)?0:e.type||0,l=e.size,f=e.sizeX||l||1,d=e.sizeY||l||1,p=e.sizeZ||l||1,v=e.custom||t[h],y=v.face.length,_=e.faceUV||new Array(y),g=e.faceColors,m=void 0===e.flat||e.flat,x=0===e.sideOrientation?0:e.sideOrientation||a.a.DEFAULTSIDE,b=new Array,C=new Array,A=new Array,w=new Array,P=new Array,O=0,M=0,S=new Array,D=0,T=0;if(m)for(T=0;T<y;T++)g&&void 0===g[T]&&(g[T]=new i.d(1,1,1,1)),_&&void 0===_[T]&&(_[T]=new i.s(0,0,1,1));if(m)for(T=0;T<y;T++){var V=v.face[T].length;for(o=2*Math.PI/V,s=.5*Math.tan(o/2),u=.5,D=0;D<V;D++)b.push(v.vertex[v.face[T][D]][0]*f,v.vertex[v.face[T][D]][1]*d,v.vertex[v.face[T][D]][2]*p),S.push(O),O++,r=_[T].x+(_[T].z-_[T].x)*(.5+s),n=_[T].y+(_[T].w-_[T].y)*(u-.5),w.push(r,n),c=s*Math.cos(o)-u*Math.sin(o),u=s*Math.sin(o)+u*Math.cos(o),s=c,g&&P.push(g[T].r,g[T].g,g[T].b,g[T].a);for(D=0;D<V-2;D++)C.push(S[0+M],S[D+2+M],S[D+1+M]);M+=V}else{for(D=0;D<v.vertex.length;D++)b.push(v.vertex[D][0]*f,v.vertex[D][1]*d,v.vertex[D][2]*p),w.push(0,0);for(T=0;T<y;T++)for(D=0;D<v.face[T].length-2;D++)C.push(v.face[T][0],v.face[T][D+2],v.face[T][D+1])}a.a.ComputeNormals(b,C,A),a.a._ComputeSides(x,b,C,A,w,e.frontUVs,e.backUVs);var z=new a.a;return z.positions=b,z.indices=C,z.normals=A,z.uvs=w,g&&m&&(z.colors=P),z},n.a.CreatePolyhedron=function(e,t,r){return X.CreatePolyhedron(e,t,r)};var X=function(){function e(){}return e.CreatePolyhedron=function(e,t,r){void 0===r&&(r=null);var i=new n.a(e,r);return t.sideOrientation=n.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,a.a.CreatePolyhedron(t).applyToMesh(i,t.updatable),i},e}();a.a.CreateIcoSphere=function(e){var t,r=e.sideOrientation||a.a.DEFAULTSIDE,n=e.radius||1,o=void 0===e.flat||e.flat,s=e.subdivisions||4,u=e.radiusX||n,c=e.radiusY||n,h=e.radiusZ||n,l=(1+Math.sqrt(5))/2,f=[-1,l,-0,1,l,0,-1,-l,0,1,-l,0,0,-1,-l,0,1,-l,0,-1,l,0,1,l,l,0,1,l,0,-1,-l,0,1,-l,0,-1],d=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],p=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],v=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],y=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],_=new Array,g=new Array,m=new Array,x=new Array,b=0,C=new Array(3),A=new Array(3);for(t=0;t<3;t++)C[t]=i.r.Zero(),A[t]=i.q.Zero();for(var w=0;w<20;w++){for(t=0;t<3;t++){var P=d[3*w+t];C[t].copyFromFloats(f[3*p[P]],f[3*p[P]+1],f[3*p[P]+2]),C[t].normalize().scaleInPlace(n),A[t].copyFromFloats(v[2*P]*(138/1024)+60/1024+y[w]*(-40/1024),v[2*P+1]*(239/1024)+26/1024+y[w]*(20/1024))}for(var O=function(e,t,r,n){var a,l=i.r.Lerp(C[0],C[2],t/s),f=i.r.Lerp(C[1],C[2],t/s),d=s===t?C[2]:i.r.Lerp(l,f,e/(s-t));if(d.normalize(),o){var p=i.r.Lerp(C[0],C[2],n/s),v=i.r.Lerp(C[1],C[2],n/s);a=i.r.Lerp(p,v,r/(s-n))}else a=new i.r(d.x,d.y,d.z);a.x/=u,a.y/=c,a.z/=h,a.normalize();var y=i.q.Lerp(A[0],A[2],t/s),w=i.q.Lerp(A[1],A[2],t/s),P=s===t?A[2]:i.q.Lerp(y,w,e/(s-t));g.push(d.x*u,d.y*c,d.z*h),m.push(a.x,a.y,a.z),x.push(P.x,P.y),_.push(b),b++},M=0;M<s;M++)for(var S=0;S+M<s;S++)O(S,M,S+1/3,M+1/3),O(S+1,M,S+1/3,M+1/3),O(S,M+1,S+1/3,M+1/3),S+M+1<s&&(O(S+1,M,S+2/3,M+2/3),O(S+1,M+1,S+2/3,M+2/3),O(S,M+1,S+2/3,M+2/3))}a.a._ComputeSides(r,g,_,m,x,e.frontUVs,e.backUVs);var D=new a.a;return D.indices=_,D.positions=g,D.normals=m,D.uvs=x,D},n.a.CreateIcoSphere=function(e,t,r){return H.CreateIcoSphere(e,t,r)};var H=function(){function e(){}return e.CreateIcoSphere=function(e,t,r){void 0===r&&(r=null);var i=new n.a(e,r);return t.sideOrientation=n.a._GetDefaultSideOrientation(t.sideOrientation),i._originalBuilderSideOrientation=t.sideOrientation,a.a.CreateIcoSphere(t).applyToMesh(i,t.updatable),i},e}();n.a.CreateDecal=function(e,t,r,i,n,o){var a={position:r,normal:i,size:n,angle:o};return Z.CreateDecal(e,t,a)};var Z=function(){function e(){}return e.CreateDecal=function(e,t,r){var s=t.getIndices(),u=t.getVerticesData(o.b.PositionKind),c=t.getVerticesData(o.b.NormalKind),h=r.position||i.r.Zero(),l=r.normal||i.r.Up(),f=r.size||i.r.One(),d=r.angle||0;if(!l){var p=new i.r(0,0,1),v=t.getScene().activeCamera,y=i.r.TransformCoordinates(p,v.getWorldMatrix());l=v.globalPosition.subtract(y)}var _=-Math.atan2(l.z,l.x)-Math.PI/2,g=Math.sqrt(l.x*l.x+l.z*l.z),m=Math.atan2(l.y,g),x=i.g.RotationYawPitchRoll(_,m,d).multiply(i.g.Translation(h.x,h.y,h.z)),b=i.g.Invert(x),C=t.getWorldMatrix().multiply(b),A=new a.a;A.indices=[],A.positions=[],A.normals=[],A.uvs=[];for(var w=0,P=function(e){var t=new i.k;if(!s||!u||!c)return t;var r=s[e];return t.position=new i.r(u[3*r],u[3*r+1],u[3*r+2]),t.position=i.r.TransformCoordinates(t.position,C),t.normal=new i.r(c[3*r],c[3*r+1],c[3*r+2]),t.normal=i.r.TransformNormal(t.normal,C),t},O=function(e,t){if(0===e.length)return e;for(var r=.5*Math.abs(i.r.Dot(f,t)),n=function(e,n){var o=i.r.GetClipFactor(e.position,n.position,t,r);return new i.k(i.r.Lerp(e.position,n.position,o),i.r.Lerp(e.normal,n.normal,o))},o=new Array,a=0;a<e.length;a+=3){var s,u,c,h=null,l=null,d=null,p=null;switch(((s=i.r.Dot(e[a].position,t)-r>0)?1:0)+((u=i.r.Dot(e[a+1].position,t)-r>0)?1:0)+((c=i.r.Dot(e[a+2].position,t)-r>0)?1:0)){case 0:o.push(e[a]),o.push(e[a+1]),o.push(e[a+2]);break;case 1:if(s&&(h=e[a+1],l=e[a+2],d=n(e[a],h),p=n(e[a],l)),u){h=e[a],l=e[a+2],d=n(e[a+1],h),p=n(e[a+1],l),o.push(d),o.push(l.clone()),o.push(h.clone()),o.push(l.clone()),o.push(d.clone()),o.push(p);break}c&&(h=e[a],l=e[a+1],d=n(e[a+2],h),p=n(e[a+2],l)),h&&l&&d&&p&&(o.push(h.clone()),o.push(l.clone()),o.push(d),o.push(p),o.push(d.clone()),o.push(l.clone()));break;case 2:s||(l=n(h=e[a].clone(),e[a+1]),d=n(h,e[a+2]),o.push(h),o.push(l),o.push(d)),u||(l=n(h=e[a+1].clone(),e[a+2]),d=n(h,e[a]),o.push(h),o.push(l),o.push(d)),c||(l=n(h=e[a+2].clone(),e[a]),d=n(h,e[a+1]),o.push(h),o.push(l),o.push(d))}}return o},M=0;M<s.length;M+=3){var S=new Array;if(S.push(P(M)),S.push(P(M+1)),S.push(P(M+2)),S=O(S,new i.r(1,0,0)),S=O(S,new i.r(-1,0,0)),S=O(S,new i.r(0,1,0)),S=O(S,new i.r(0,-1,0)),S=O(S,new i.r(0,0,1)),0!==(S=O(S,new i.r(0,0,-1))).length)for(var D=0;D<S.length;D++){var T=S[D];A.indices.push(w),T.position.toArray(A.positions,3*w),T.normal.toArray(A.normals,3*w),A.uvs.push(.5+T.position.x/f.x),A.uvs.push(.5+T.position.y/f.y),w++}}var V=new n.a(e,t.getScene());return A.applyToMesh(V),V.position=h.clone(),V.rotation=new i.r(m,_,d),V},e}();r.d(t,"a",(function(){return Y}));var Y=function(){function e(){}return e.CreateBox=function(e,t,r){return void 0===r&&(r=null),h.CreateBox(e,t,r)},e.CreateSphere=function(e,t,r){return void 0===r&&(r=null),l.CreateSphere(e,t,r)},e.CreateDisc=function(e,t,r){return void 0===r&&(r=null),c.CreateDisc(e,t,r)},e.CreateIcoSphere=function(e,t,r){return void 0===r&&(r=null),H.CreateIcoSphere(e,t,r)},e.CreateRibbon=function(e,t,r){return void 0===r&&(r=null),u.CreateRibbon(e,t,r)},e.CreateCylinder=function(e,t,r){return void 0===r&&(r=null),d.CreateCylinder(e,t,r)},e.CreateTorus=function(e,t,r){return void 0===r&&(r=null),p.CreateTorus(e,t,r)},e.CreateTorusKnot=function(e,t,r){return void 0===r&&(r=null),v.CreateTorusKnot(e,t,r)},e.CreateLineSystem=function(e,t,r){return I.CreateLineSystem(e,t,r)},e.CreateLines=function(e,t,r){return void 0===r&&(r=null),I.CreateLines(e,t,r)},e.CreateDashedLines=function(e,t,r){return void 0===r&&(r=null),I.CreateDashedLines(e,t,r)},e.ExtrudeShape=function(e,t,r){return void 0===r&&(r=null),F.ExtrudeShape(e,t,r)},e.ExtrudeShapeCustom=function(e,t,r){return void 0===r&&(r=null),F.ExtrudeShapeCustom(e,t,r)},e.CreateLathe=function(e,t,r){return void 0===r&&(r=null),R.CreateLathe(e,t,r)},e.CreatePlane=function(e,t,r){return void 0===r&&(r=null),N.CreatePlane(e,t,r)},e.CreateGround=function(e,t,r){return void 0===r&&(r=null),G.CreateGround(e,t,r)},e.CreateTiledGround=function(e,t,r){return void 0===r&&(r=null),G.CreateTiledGround(e,t,r)},e.CreateGroundFromHeightMap=function(e,t,r,i){return void 0===i&&(i=null),G.CreateGroundFromHeightMap(e,t,r,i)},e.CreatePolygon=function(e,t,r,i){return void 0===r&&(r=null),void 0===i&&(i=earcut),U.CreatePolygon(e,t,r,i)},e.ExtrudePolygon=function(e,t,r,i){return void 0===r&&(r=null),void 0===i&&(i=earcut),U.ExtrudePolygon(e,t,r,i)},e.CreateTube=function(e,t,r){return void 0===r&&(r=null),j.CreateTube(e,t,r)},e.CreatePolyhedron=function(e,t,r){return void 0===r&&(r=null),X.CreatePolyhedron(e,t,r)},e.CreateDecal=function(e,t,r){return Z.CreateDecal(e,t,r)},e}()},63:function(e,t,r){"use strict";var i=r(1),n=r(4),o=r(0),a=r(40),s=r(15),u=r(43),c=r(20),h=r(2),l=r(26),f=r(6),d=(r(46),r(48),"#extension GL_OES_standard_derivatives : enable\n#define SQRT2 1.41421356\n#define PI 3.14159\nprecision highp float;\nuniform vec3 mainColor;\nuniform vec3 lineColor;\nuniform vec4 gridControl;\nuniform vec3 gridOffset;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogFragmentDeclaration>\n\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform sampler2D opacitySampler;\nuniform vec2 vOpacityInfos;\n#endif\nfloat getVisibility(float position) {\n\nfloat majorGridFrequency=gridControl.y;\nif (floor(position+0.5) == floor(position/majorGridFrequency+0.5)*majorGridFrequency)\n{\nreturn 1.0;\n}\nreturn gridControl.z;\n}\nfloat getAnisotropicAttenuation(float differentialLength) {\nconst float maxNumberOfLines=10.0;\nreturn clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines,0.0,1.0);\n}\nfloat isPointOnLine(float position,float differentialLength) {\nfloat fractionPartOfPosition=position-floor(position+0.5);\nfractionPartOfPosition/=differentialLength;\nfractionPartOfPosition=clamp(fractionPartOfPosition,-1.,1.);\nfloat result=0.5+0.5*cos(fractionPartOfPosition*PI);\nreturn result;\n}\nfloat contributionOnAxis(float position) {\nfloat differentialLength=length(vec2(dFdx(position),dFdy(position)));\ndifferentialLength*=SQRT2;\n\nfloat result=isPointOnLine(position,differentialLength);\n\nfloat visibility=getVisibility(position);\nresult*=visibility;\n\nfloat anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);\nresult*=anisotropicAttenuation;\nreturn result;\n}\nfloat normalImpactOnAxis(float x) {\nfloat normalImpact=clamp(1.0-3.0*abs(x*x*x),0.0,1.0);\nreturn normalImpact;\n}\nvoid main(void) {\n\nfloat gridRatio=gridControl.x;\nvec3 gridPos=(vPosition+gridOffset.xyz)/gridRatio;\n\nfloat x=contributionOnAxis(gridPos.x);\nfloat y=contributionOnAxis(gridPos.y);\nfloat z=contributionOnAxis(gridPos.z);\n\nvec3 normal=normalize(vNormal);\nx*=normalImpactOnAxis(normal.x);\ny*=normalImpactOnAxis(normal.y);\nz*=normalImpactOnAxis(normal.z);\n\nfloat grid=clamp(x+y+z,0.,1.);\n\nvec3 color=mix(mainColor,lineColor,grid);\n#ifdef FOG\n#include<fogFragment>\n#endif\nfloat opacity=1.0;\n#ifdef TRANSPARENT\nopacity=clamp(grid,0.08,gridControl.w*grid);\n#endif\n#ifdef OPACITY\nopacity*=texture2D(opacitySampler,vOpacityUV).a;\n#endif\n\ngl_FragColor=vec4(color.rgb,opacity);\n#ifdef TRANSPARENT\n#ifdef PREMULTIPLYALPHA\ngl_FragColor.rgb*=opacity;\n#endif\n#else\n#endif\n}");f.a.ShadersStore.gridPixelShader=d;r(52),r(56);var p="precision highp float;\n\nattribute vec3 position;\nattribute vec3 normal;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n\nuniform mat4 projection;\nuniform mat4 world;\nuniform mat4 view;\nuniform mat4 worldView;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\n#include<fogVertexDeclaration>\n#ifdef OPACITY\nvarying vec2 vOpacityUV;\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\nvoid main(void) {\n#ifdef FOG\nvec4 worldPos=world*vec4(position,1.0);\n#endif\n#include<fogVertex>\nvec4 cameraSpacePosition=worldView*vec4(position,1.0);\ngl_Position=projection*cameraSpacePosition;\n#ifdef OPACITY\n#ifndef UV1\nvec2 uv=vec2(0.,0.);\n#endif\n#ifndef UV2\nvec2 uv2=vec2(0.,0.);\n#endif\nif (vOpacityInfos.x == 0.)\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv,1.0,0.0));\n}\nelse\n{\nvOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));\n}\n#endif\nvPosition=position;\nvNormal=normal;\n}";f.a.ShadersStore.gridVertexShader=p;var v=function(e){function t(){var t=e.call(this)||this;return t.OPACITY=!1,t.TRANSPARENT=!1,t.FOG=!1,t.PREMULTIPLYALPHA=!1,t.UV1=!1,t.UV2=!1,t.rebuild(),t}return i.c(t,e),t}(a.a),y=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.mainColor=o.c.Black(),i.lineColor=o.c.Teal(),i.gridRatio=1,i.gridOffset=o.r.Zero(),i.majorUnitFrequency=10,i.minorUnitVisibility=.33,i.opacity=1,i.preMultiplyAlpha=!1,i._gridControl=new o.s(i.gridRatio,i.majorUnitFrequency,i.minorUnitVisibility,i.opacity),i}return i.c(t,e),t.prototype.needAlphaBlending=function(){return this.opacity<1||this._opacityTexture&&this._opacityTexture.isReady()},t.prototype.needAlphaBlendingForMesh=function(e){return this.needAlphaBlending()},t.prototype.isReadyForSubMesh=function(e,t,r){if(this.isFrozen&&this._wasPreviouslyReady&&t.effect)return!0;t._materialDefines||(t._materialDefines=new v);var i=t._materialDefines,n=this.getScene();if(!this.checkReadyOnEveryCall&&t.effect&&this._renderId===n.getRenderId())return!0;if(i.TRANSPARENT!==this.opacity<1&&(i.TRANSPARENT=!i.TRANSPARENT,i.markAsUnprocessed()),i.PREMULTIPLYALPHA!=this.preMultiplyAlpha&&(i.PREMULTIPLYALPHA=!i.PREMULTIPLYALPHA,i.markAsUnprocessed()),i._areTexturesDirty&&(i._needUVs=!1,n.texturesEnabled&&this._opacityTexture&&c.a.OpacityTextureEnabled)){if(!this._opacityTexture.isReady())return!1;i._needUVs=!0,i.OPACITY=!0}if(s.a.PrepareDefinesForMisc(e,n,!1,!1,this.fogEnabled,!1,i),i.isDirty){i.markAsProcessed(),n.resetCachedMaterial(),s.a.PrepareDefinesForAttributes(e,i,!1,!1);var o=[h.b.PositionKind,h.b.NormalKind];i.UV1&&o.push(h.b.UVKind),i.UV2&&o.push(h.b.UV2Kind);var a=i.toString();t.setEffect(n.getEngine().createEffect("grid",o,["projection","worldView","mainColor","lineColor","gridControl","gridOffset","vFogInfos","vFogColor","world","view","opacityMatrix","vOpacityInfos"],["opacitySampler"],a,void 0,this.onCompiled,this.onError),i)}return!(!t.effect||!t.effect.isReady())&&(this._renderId=n.getRenderId(),this._wasPreviouslyReady=!0,!0)},t.prototype.bindForSubMesh=function(e,t,r){var i=this.getScene();if(r._materialDefines){var n=r.effect;n&&(this._activeEffect=n,this.bindOnlyWorldMatrix(e),this._activeEffect.setMatrix("worldView",e.multiply(i.getViewMatrix())),this._activeEffect.setMatrix("view",i.getViewMatrix()),this._activeEffect.setMatrix("projection",i.getProjectionMatrix()),this._mustRebind(i,n)&&(this._activeEffect.setColor3("mainColor",this.mainColor),this._activeEffect.setColor3("lineColor",this.lineColor),this._activeEffect.setVector3("gridOffset",this.gridOffset),this._gridControl.x=this.gridRatio,this._gridControl.y=Math.round(this.majorUnitFrequency),this._gridControl.z=this.minorUnitVisibility,this._gridControl.w=this.opacity,this._activeEffect.setVector4("gridControl",this._gridControl),this._opacityTexture&&c.a.OpacityTextureEnabled&&(this._activeEffect.setTexture("opacitySampler",this._opacityTexture),this._activeEffect.setFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),this._activeEffect.setMatrix("opacityMatrix",this._opacityTexture.getTextureMatrix()))),s.a.BindFogParameters(i,t,this._activeEffect),this._afterBind(t,this._activeEffect))}},t.prototype.dispose=function(t){e.prototype.dispose.call(this,t)},t.prototype.clone=function(e){var r=this;return n.a.Clone((function(){return new t(e,r.getScene())}),this)},t.prototype.serialize=function(){var e=n.a.Serialize(this);return e.customType="BABYLON.GridMaterial",e},t.prototype.getClassName=function(){return"GridMaterial"},t.Parse=function(e,r,i){return n.a.Parse((function(){return new t(e.name,r)}),e,r,i)},i.b([Object(n.d)()],t.prototype,"mainColor",void 0),i.b([Object(n.d)()],t.prototype,"lineColor",void 0),i.b([Object(n.c)()],t.prototype,"gridRatio",void 0),i.b([Object(n.d)()],t.prototype,"gridOffset",void 0),i.b([Object(n.c)()],t.prototype,"majorUnitFrequency",void 0),i.b([Object(n.c)()],t.prototype,"minorUnitVisibility",void 0),i.b([Object(n.c)()],t.prototype,"opacity",void 0),i.b([Object(n.c)()],t.prototype,"preMultiplyAlpha",void 0),i.b([Object(n.j)("opacityTexture")],t.prototype,"_opacityTexture",void 0),i.b([Object(n.b)("_markAllSubMeshesAsTexturesDirty")],t.prototype,"opacityTexture",void 0),t}(u.a);l.a.RegisteredTypes["BABYLON.GridMaterial"]=y,r.d(t,"a",(function(){return y}))}}]);